((e,t,r,o,n,i,l,a,s,c,f,d,u)=>{"use strict";var m=t.findByStoreName("CollectiblesPurchaseStore"),p=t.findByStoreName("ProfileEffectStore"),y=t.findByStoreName("UserProfileStore"),h=t.findByStoreName("UserStore"),E=o.FluxDispatcher;function g(){E.dispatch({type:"USER_SETTINGS_ACCOUNT_SUBMIT_SUCCESS"})}var v=!0,S=null;function P(e){var[t,o]=r.useState((()=>S=e));return[t,e=>{o(S=e),v&&g()}]}var b,C=null;function B(e){var[t,o]=r.useState((()=>C=e));return[t,e=>{o(C=e),v&&g()}]}function A(e){b=e}var I=t.findByName("useProfileThemeColors",!1)??{default(){}},T=String.fromCodePoint(8203),w=4096,N=917504,_=N+w-1;function F(e,t){return String.fromCodePoint(...[..."[#".concat(e.toString(16),",#").concat(t.toString(16),"]")].map((e=>e.codePointAt(0)+N)))}function R(e){var[t,r]=e.matchAll(/(?<=#)[\dA-Fa-f]{1,6}/g);return[t?parseInt(t[0],16):-1,r?parseInt(r[0],16):-1]}function x(e){if(0===e)return String.fromCodePoint(N);for(var t="";e>0;e=Math.trunc(e/w))t=String.fromCodePoint(e%w+N)+t;return t}function D(e){if(""===e)return-1;for(var t=0,r=0;r<e.length;r++){if(t>16777215)return-2;t+=e.codePointAt(r)*w**(e.length-1-r)}return t}function k(e){if(0n===e)return String.fromCodePoint(N);for(var t="";e>0n;e/=BigInt(w))t=String.fromCodePoint(Number(e%BigInt(w))+N)+t;return t}function z(e){if(""===e)return-1n;for(var t=0n,r=0;r<e.length;r++){if(t>=10000000000000000000n)return-2n;t+=BigInt(e.codePointAt(r))*BigInt(w)**BigInt(e.length-1-r)}return t}function L(e){var t=["","",""],r=0;for(var o of e){var n=o.codePointAt(0);if(8203===n){if(r>=2)break;r++}else if(N>n||n>_){if(r>0||""!==t[0])break}else t[r]+=String.fromCodePoint(n-N)}return t}function H(e,t,r){t>-1?(e.themeColors=[t,r>-1?r:t],e.premiumType=2):r>-1&&(e.themeColors=[r,r],e.premiumType=2)}function U(e,t){t>-1n&&(e.profileEffectId=e.profileEffectID=t.toString(),e.premiumType=2)}function V(e){return"function"==typeof e[Symbol.iterator]}function O(e){return null!==e&&"object"==typeof e}function M(e){return O(e)&&"type"in e}function G(e){return"children"in e.props}function W(e){return"symbol"==typeof e?Symbol.keyFor(e)??null:"function"==typeof e?(e.displayName||e.name)??null:"_context"in e?e._context.displayName??null:e.displayName?e.displayName:"render"in e?(e.render.displayName||e.render.name)??null:"type"in e?W(e.type):null}function X(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;if(O(e))if(V(e)){if(r>0)for(var o of e){var n=X(o,t,r-1);if(n)return n}}else{if(t(e))return e;if(G(e))return X(e.props.children,t,r-1)}return null}function j(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;if(O(e))if(V(e)){if(r>0)for(var o of e){var n=j(o,t,r-1);if(n)return n}}else if(G(e))return t(e.props.children)?e:j(e.props.children,t,r-1);return null}var K,Y=t.findByName("ProfileEffectRecord"),Z=a.semanticColors,q=t.find((e=>e.default?.internal?.resolveSemanticColor))?.default.internal.resolveSemanticColor??t.find((e=>e.meta?.resolveSemanticColor))?.meta.resolveSemanticColor??(()=>{}),J=t.findByProps("useAvatarColors")?.useAvatarColors??(()=>{}),Q=t.findByProps("useThemeContext")?.useThemeContext??(()=>({})),$=t.findByProps("ThemeContextProvider")?.ThemeContextProvider??(e=>{var{children:t}=e;return t}),ee=t.findByName("EditProfileEffectActionSheet"),te=ee?e=>{var{currentEffectId:t,effects:o,onSelect:i,user:l}=e,a=ee({user:l}),s=Q(),c=r.useMemo((()=>o.map((e=>({items:new Y(e)})))),[o]);if(n.storage.forceFallbackEffectPicker)return r.createElement(ye,e);var f=!1,d=X(a,(e=>"EditProfileEffectInner"===W(e.type)||"profileEffects"in e.props&&"selectedProfileEffect"in e.props&&"function"==typeof e.props.setSelectedProfileEffect&&(f=!0)));if(!d)return K||r.createElement(ye,e);var u=X(a,(e=>"Button"===W(e.type)));if(!u)return K||r.createElement(ye,e);if(f){void 0===d.props.selectedProfileEffect&&d.props.setSelectedProfileEffect(e.currentEffectId?{id:e.currentEffectId}:null),d.props.profileEffects=e.effects;var m=j(a,(e=>Array.isArray(e)&&e.some((e=>"DisplayBanner"===W(e.type)))));if(m){var p=a;m.props.children=r.createElement($,{theme:p.props.theme,primaryColor:p.props.primaryColor,secondaryColor:p.props.secondaryColor,children:m.props.children}),p.props.theme=s.theme,p.props.primaryColor=s.primaryColor,p.props.secondaryColor=s.secondaryColor}}else void 0===d.props.selectedProfileEffect&&d.props.setSelectedProfileEffect(t?new Y({id:t}):null),d.props.purchases=c;return A(l.id),u.props.onPress=()=>{A(void 0),i(o.find((e=>e.id===d.props.selectedProfileEffect?.id))?.config??null)},K=a}:ye,re=t.findByProps("triggerHapticFeedback"),oe=re?.HapticFeedbackTypes??{},ne=re?.triggerHapticFeedback??(()=>{}),ie=c.getAssetIDByName("img_none"),le=t.findByProps("DEFAULT_PROFILE_EFFECT_WH_RATIO")?.DEFAULT_PROFILE_EFFECT_WH_RATIO??45/88,ae=c.getAssetIDByName("sample-profile-small")??{uri:"https://discordapp.com/assets/f328a6f8209d4f1f5022.png"},se=c.getAssetIDByName("toast_copy_link");c.getAssetIDByName("Small");var ce=t.findByProps("Radius")?.Radius??{},fe=t.findByProps("Spacing")?.Spacing??{},de=t.findByProps("SafeAreaContext")?.SafeAreaContext,ue=t.findByName("useWindowDimensions")??(()=>{}),me=3;function pe(e){var{label:t,isSelected:o,size:n,colors:i,onPress:l,style:a,children:s}=e,[c,f,d]=i;return r.createElement(Ve,{accessibilityLabel:t,accessibilityRole:"button",accessibilityState:{selected:o},disabled:o,onPress(){ne(oe.IMPACT_LIGHT),l()},style:[{height:n,width:n,overflow:"hidden",backgroundColor:f,borderColor:c,borderRadius:ce.sm,borderWidth:2},o&&{borderColor:d},a]},s)}function ye(e){var{currentEffectId:t,effects:o,onSelect:n}=e,[i,a]=r.useState(t),[c,f]=r.useState(0),{theme:d}=Q(),u=r.useMemo((()=>[q(d,Z.BACKGROUND_PRIMARY),q(d,Z.BACKGROUND_FLOATING),q(d,Z.BUTTON_OUTLINE_BRAND_BORDER_ACTIVE)]),[d]),m=ue(),p=r.useContext(de),y=r.useMemo((()=>{for(var e=s.chunk([null,...o],me),t=e[e.length-1];3>t.length;)t.push(void 0);return e}),[o]);return r.createElement(ve,{transparentHeader:!0,scrollable:!0,startExpanded:!0,startHeight:m.height-p.top},r.createElement(Se,{scrollsToTop:!1},r.createElement(l.View,{style:{flex:1,flexDirection:"column",alignItems:"center",paddingBottom:88}},r.createElement(ke,{variant:"redesign/heading-18/bold",color:"header-primary",style:{margin:fe.PX_16}},t?"Change Effect":"Add Profile Effect"),r.createElement(l.View,{style:{width:"72%",minHeight:38}},r.createElement(ke,{variant:"heading-md/bold",color:"header-primary",style:{textAlign:"center"}},o.find((e=>e.id===i))?.config.title??"None")),r.createElement(l.View,{style:{flex:1,width:"92%",marginTop:3}},r.createElement(ze,{accessibilityLabel:"Profile Effect Selection Section",numColumns:1,estimatedItemSize:98,ItemSeparatorComponent:()=>r.createElement(l.View,{style:{height:fe.PX_16}}),contentContainerStyle:{paddingHorizontal:fe.PX_4},data:y,extraData:i,renderItem(e){var{item:t}=e;return r.createElement(l.View,{style:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:fe.PX_16}},t.map((e=>e?r.createElement(pe,{label:e.config.accessibilityLabel,isSelected:e.id===i,size:c,colors:u,onPress(){a(e.id)}},r.createElement(De,{effect:e.config})):null===e?r.createElement(pe,{label:"None",isSelected:!i,size:c,colors:u,onPress(){a(void 0)},style:{alignItems:"center",justifyContent:"center"}},r.createElement(xe,{source:ie,size:xe.Sizes.LARGE}),r.createElement(ke,{variant:"text-sm/medium",color:"header-primary",style:{marginTop:fe.PX_4}},"None")):r.createElement(l.View,{style:{width:c,height:c}}))))},onLayout(e){f((e.nativeEvent.layout.width-64)/me)}})))),r.createElement(Re,{text:"Apply",textStyle:{fontSize:16},onPress(){n(o.find((e=>e.id===i))?.config??null)},style:{position:"absolute",right:0,bottom:0,left:0,height:48,marginHorizontal:36,marginBottom:fe.PX_48,borderRadius:ce.round}}))}var he=t.findByName("showCustomColorPickerActionSheet")??(()=>{});function Ee(e){var t;return(t=e).color??(t.color=0),he(e)}var ge="__FPTE__",ve=t.findByProps("BottomSheet")?.BottomSheet??t.findByProps("ActionSheet")?.ActionSheet??(()=>{throw Error("FakeProfileThemesAndEffects threw an error to avoid an otherwise-inevitable, unrecoverable freeze.")}),Se=t.findByProps("BottomSheetScrollView")?.BottomSheetScrollView??(()=>null),Pe=t.findByProps("showActionSheet"),be=Pe?.showActionSheet??(()=>{}),Ce=Pe?.default?.hideActionSheet??(()=>{}),Be=f.Forms.FormSection,Ae=f.Forms.FormRow,Ie=f.Forms.FormRadioRow,Te=f.Forms.FormSwitchRow,we=f.Forms.FormCardSection;function Ne(e){var{guildId:t}=e,[o,n]=P(null),[a,s]=B(null),[c,f]=r.useState(null),[u,m]=(e=>{var[t,o]=r.useState((()=>v=!0));return[t,e=>{o(v=e),g()}]})(),[y,S]=r.useState(!1),{theme:b}=Q(),[C,I]=r.useMemo((()=>[q(b,Z.HEADER_SECONDARY),q(b,Z.BACKGROUND_ACCENT)]),[b]),w=J(h.getCurrentUser().getAvatarURL(t,80),I,!1);return r.createElement(we,{title:"FPTE Builder",cardStyle:{backgroundColor:"transparent"}},r.createElement(l.View,{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"}},r.createElement(Fe,{fgColor:C,label:"Primary",bgColor:o,onPress(){Ee({color:o,onSelect:n,suggestedColors:w})}}),r.createElement(Fe,{fgColor:C,label:"Accent",bgColor:a,onPress(){Ee({color:a,onSelect:s,suggestedColors:w})}}),r.createElement(Fe,{fgColor:C,label:"Effect",onPress(){var e,t;e=f,t=c?.id,E.subscribe("HIDE_ACTION_SHEET",(function e(t){t.key===ge&&(E.unsubscribe("HIDE_ACTION_SHEET",e),A(void 0))})),be({content:r.createElement(te,{effects:p.profileEffects,onSelect(t){e(t),Ce(ge)},user:h.getCurrentUser(),currentEffectId:t}),key:ge})}},c&&r.createElement(De,{effect:c,style:{width:"100%",height:"100%"}})),r.createElement(l.View,{style:{display:"flex",alignItems:"center",flexDirection:"column"}},r.createElement(Re,{text:"Copy FPTE",size:Re.Sizes.SMALL,onPress(){var e,t=((e,t,r,o)=>{var n="";if(o){if(e>=0)return n=F(e,0>t?e:t),""!==r&&(n+=T+k(BigInt(r))),n;if(t>=0)return n=F(t,t),""!==r&&(n+=T+k(BigInt(r))),n}else if(0>e)0>t||(n=x(t));else if(n=x(e),t>=0&&e!==t)return n+=T+x(t),""!==r&&(n+=T+k(BigInt(r))),n;return""!==r&&(n+=T+T+k(BigInt(r))),n})(o??-1,a??-1,c?.id??"",y);t?(e=t,d.setString(e),i.showToast("FPTE copied to clipboard!",se)):i.showToast("FPTE Builder is empty; nothing to copy!")}}),r.createElement(Re,{text:"Reset",look:Re.Looks.LINK,color:Re.Colors.TRANSPARENT,size:Re.Sizes.SMALL,...null===o&&null===a&&!c&&{pointerEvents:"none",style:{opacity:0}},onPress(){n(null),s(null),f(null)}}))),r.createElement(Te,{label:"FPTE Builder Preview",value:u,onValueChange:m}),r.createElement(Te,{label:"Build backwards compatible FPTE",subLabel:"Will use more characters",value:y,onValueChange:S}))}var _e,Fe=e=>{var{label:t,fgColor:o,bgColor:n,onPress:i,children:a}=e;return r.createElement(l.View,{style:{width:50}},r.createElement(Ve,{accessibilityLabel:t,accessibilityRole:"button",onPress:i,style:[{display:"flex",alignItems:"center",justifyContent:"center",height:50,overflow:"hidden",borderColor:o,borderStyle:"dashed",borderWidth:2,borderRadius:ce.xs},null!=n&&{backgroundColor:"#"+n.toString(16).padStart(6,"0"),borderStyle:"solid"},!!a&&{borderWidth:0}]},a??(null==n&&r.createElement(He,{fill:o,width:"40%",height:"40%",viewBox:"0 0 144 144"},r.createElement(Ue,{d:"M144 64H80V0H64v64H0v16h64v64h16V80h64Z"})))),!!t&&r.createElement(ke,{variant:"text-sm/normal",style:{marginTop:fe.PX_4,textAlign:"center"}},t))},Re=f.Button,xe=t.findByProps("IconSizes")?.default??(()=>null),De=e=>{var{effect:t,style:o}=e;return r.createElement(l.View,{style:o},r.createElement(l.Image,{resizeMode:"cover",source:ae,style:{width:"100%",height:"100%"}}),r.createElement(l.Image,{alt:t.accessibilityLabel,resizeMethod:"resize",resizeMode:"cover",source:{uri:t.thumbnailPreviewSrc},style:{position:"absolute",width:"100%",aspectRatio:le}}))},ke=t.findByProps("TextStyleSheet")?.Text??(()=>null),ze=t.findByName("FlashList")??(()=>null),Le=t.findByProps("Svg"),He=Le?.Svg??(()=>null),Ue=Le?.Path??(()=>null),Ve=t.findByProps("PressableOpacity")?.PressableOpacity??(()=>null),Oe=t.findByName("GuildProfileEditForm",!1),Me=t.findByPropsAll("NONE_ITEM"),Ge=t.findByName("UserProfileEditForm",!1),We=[];return{onLoad(){We.push(e.instead("getPurchase",m,((e,t)=>b?{purchasedAt:new Date}:t(e))),e.after("getUserProfile",y,((e,t)=>{if(void 0===t)return t;if(n.storage.prioritizeNitro){if(void 0!==t.themeColors){if(void 0===t.profileEffectId&&void 0===t.profileEffectID){var r=L(t.bio);-2===D(r[0])?U(t,z(r[1])):U(t,z(r[2]))}return t}if(void 0!==t.profileEffectId||void 0!==t.profileEffectID){var o=L(t.bio),i=D(o[0]);return-2===i?H(t,...R(o[0])):H(t,i,D(o[1])),t}}var l=L(t.bio),a=D(l[0]);return-2===a?(H(t,...R(l[0])),U(t,z(l[1]))):(H(t,a,D(l[1])),U(t,z(l[2]))),t})),e.after("default",Oe,((e,t)=>{if(n.storage.hideBuilder)return t;var o,i=j(t,(e=>Array.isArray(e)&&e.some((e=>!(!M(e)||"EditGuildIdentityBio"!==W(e.type)||(o=e.props.displayProfile?.guildId,0))))));return i&&i.props.children.splice(2,0,r.createElement(Ne,{guildId:o})),t})),...Me.map((t=>e.after("default",t,((e,t)=>(b&&(void 0!==p.profileEffects?(t.splice(1),t[0].items.splice(1),p.profileEffects.forEach((e=>{t[0].items.push(new Y(e))})),_e=t):t=_e),t))))),e.after("default",I,((e,t)=>{var[r,o,n]=e;if((null!=r&&r.id===b||n)&&v){if(null!==S)return[S,C??S];if(null!==C)return[C,C]}return t})),e.after("default",Ge,((e,t)=>{if(n.storage.hideBuilder)return t;var o=j(t,(e=>Array.isArray(e)&&e.some((e=>M(e)&&"EditUserProfileBio"===W(e.type)))));return o&&o.props.children.splice(2,0,r.createElement(Ne,null)),t})))},onUnload(){We.forEach((e=>{e()}))},settings:()=>(u.useProxy(n.storage),r.createElement(l.ScrollView,null,r.createElement(Be,{title:"Settings"},r.createElement(Ae,{label:"Source to prioritize"}),r.createElement(Ie,{label:"Nitro",selected:!!n.storage.prioritizeNitro,onPress(){n.storage.prioritizeNitro=!0}}),r.createElement(Ie,{label:"About Me",selected:!n.storage.prioritizeNitro,onPress(){n.storage.prioritizeNitro=!1}}),r.createElement(Te,{label:"Hide Builder",subLabel:"Hide the FPTE Builder in the User Profile and Server Profiles settings pages",value:!!n.storage.hideBuilder,onValueChange(e){n.storage.hideBuilder=e}}),r.createElement(Te,{label:"Force fallback effect picker",value:!!n.storage.forceFallbackEffectPicker,onValueChange(e){n.storage.forceFallbackEffectPicker=e}}))))}})(vendetta.patcher,vendetta.metro,React,vendetta.metro.common,vendetta.plugin,vendetta.ui.toasts,vendetta.metro.common.ReactNative,vendetta.ui,vendetta.metro.common.lodash,vendetta.ui.assets,vendetta.ui.components,vendetta.metro.common.clipboard,vendetta.storage);
