((e,t,r,o,n,i,l,a,s,c,f,d,u)=>{"use strict";var m=e.FluxDispatcher,p=t.findByStoreName("CollectiblesPurchaseStore"),y=t.findByStoreName("ProfileEffectStore"),h=t.findByStoreName("UserProfileStore"),E=t.findByStoreName("UserStore"),g=n.semanticColors,v=t.find((e=>e.default?.internal?.resolveSemanticColor))?.default.internal.resolveSemanticColor??t.find((e=>e.meta?.resolveSemanticColor))?.meta.resolveSemanticColor??(()=>{}),P=t.findByProps("useAvatarColors")?.useAvatarColors??(()=>{}),S=t.findByProps("getProfileTheme").getProfileTheme,C=t.findByProps("useThemeContext")?.useThemeContext??(()=>({})),b=t.findByProps("ThemeContextProvider")?.ThemeContextProvider??(e=>{var{children:t}=e;return t});function B(){m.dispatch({type:"USER_SETTINGS_ACCOUNT_SUBMIT_SUCCESS"})}var A=!0,I=null;function T(e){var[t,r]=o.useState((()=>I=e));return[t,e=>{r(I=e),A&&B()}]}var N,w=null;function _(e){var[t,r]=o.useState((()=>w=e));return[t,e=>{r(w=e),A&&B()}]}function F(e){N=e}var R=(()=>{var e=t.findByName("useProfileTheme",!1);return e?()=>r.after("default",e,((e,t)=>{var[r]=e,{user:o}=r;return(null!=o&&o.id===N||"pendingThemeColors"in r)&&A&&(null!==I?(t.theme=S(I),t.primaryColor=I,t.secondaryColor=w??I):null!==w&&(t.theme=S(w),t.primaryColor=w,t.secondaryColor=w)),t})):(e=t.findByName("useProfileThemeColors",!1))?()=>r.after("default",e,((e,t)=>{var[r,o,n]=e;if((null!=r&&r.id===N||n)&&A){if(null!==I)return[I,w??I];if(null!==w)return[w,w]}return t})):()=>()=>!0})(),x=String.fromCodePoint(8203),D=4096,k=917504,z=k+D-1;function L(e,t){return String.fromCodePoint(...[..."[#".concat(e.toString(16),",#").concat(t.toString(16),"]")].map((e=>e.codePointAt(0)+k)))}function U(e){var[t,r]=e.matchAll(/(?<=#)[\dA-Fa-f]{1,6}/g);return[t?parseInt(t[0],16):-1,r?parseInt(r[0],16):-1]}function H(e){if(0===e)return String.fromCodePoint(k);for(var t="";e>0;e=Math.trunc(e/D))t=String.fromCodePoint(e%D+k)+t;return t}function V(e){if(""===e)return-1;for(var t=0,r=0;r<e.length;r++){if(t>16777215)return-2;t+=e.codePointAt(r)*D**(e.length-1-r)}return t}function O(e){if(0n===e)return String.fromCodePoint(k);for(var t="";e>0n;e/=BigInt(D))t=String.fromCodePoint(Number(e%BigInt(D))+k)+t;return t}function M(e){if(""===e)return-1n;for(var t=0n,r=0;r<e.length;r++){if(t>=10000000000000000000n)return-2n;t+=BigInt(e.codePointAt(r))*BigInt(D)**BigInt(e.length-1-r)}return t}function G(e){var t=["","",""],r=0;for(var o of e){var n=o.codePointAt(0);if(8203===n){if(r>=2)break;r++}else if(k>n||n>z){if(r>0||t[0])break}else t[r]+=String.fromCodePoint(n-k)}return t}function W(e,t,r){t>-1?(e.themeColors=[t,r>-1?r:t],e.premiumType=2):r>-1&&(e.themeColors=[r,r],e.premiumType=2)}function X(e,t){t>-1n&&(e.profileEffectId=e.profileEffectID=t.toString(),e.premiumType=2)}function j(e){return"function"==typeof e[Symbol.iterator]}function K(e){return null!==e&&"object"==typeof e}function Y(e){return K(e)&&"type"in e}function Z(e){return"children"in e.props}function q(e){return"symbol"==typeof e?Symbol.keyFor(e)||null:"function"==typeof e?e.displayName||e.name||null:"_context"in e?e._context.displayName||null:e.displayName?e.displayName:"render"in e?e.render.displayName||e.render.name||null:"type"in e?q(e.type):null}function J(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;if(K(e))if(j(e)){if(r>0)for(var o of e){var n=J(o,t,r-1);if(n)return n}}else{if(t(e))return e;if(Z(e))return J(e.props.children,t,r-1)}return null}function Q(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:200;if(K(e))if(j(e)){if(r>0)for(var o of e){var n=Q(o,t,r-1);if(n)return n}}else if(Z(e))return t(e.props.children)?e:Q(e.props.children,t,r-1);return null}var $,ee=t.findByName("ProfileEffectRecord"),te=t.findByName("EditProfileEffectActionSheet"),re=te?e=>{var{currentEffectId:t,effects:r,onSelect:n,user:l}=e,a=te({user:l}),s=C(),c=o.useMemo((()=>r.map((e=>({items:new ee(e)})))),[r]);if(i.storage.forceFallbackEffectPicker)return o.createElement(he,e);var f=!1,d=J(a,(e=>"EditProfileEffectInner"===q(e.type)||"profileEffects"in e.props&&"selectedProfileEffect"in e.props&&"function"==typeof e.props.setSelectedProfileEffect&&(f=!0)));if(!d)return $||o.createElement(he,e);var u=J(a,(e=>"Button"===q(e.type)));if(!u)return $||o.createElement(he,e);if(f){void 0===d.props.selectedProfileEffect&&d.props.setSelectedProfileEffect(e.currentEffectId?{id:e.currentEffectId}:null),d.props.profileEffects=e.effects;var m=Q(a,(e=>Array.isArray(e)&&e.some((e=>"DisplayBanner"===q(e.type)))));if(m){var p=a;m.props.children=o.createElement(b,{theme:p.props.theme,primaryColor:p.props.primaryColor,secondaryColor:p.props.secondaryColor,children:m.props.children}),p.props.theme=s.theme,p.props.primaryColor=s.primaryColor,p.props.secondaryColor=s.secondaryColor}}else void 0===d.props.selectedProfileEffect&&d.props.setSelectedProfileEffect(t?new ee({id:t}):null),d.props.purchases=c;return F(l.id),u.props.onPress=()=>{F(void 0),n(r.find((e=>e.id===d.props.selectedProfileEffect?.id))?.config??null)},$=a}:he,oe=t.findByProps("triggerHapticFeedback"),ne=oe?.HapticFeedbackTypes??{},ie=oe?.triggerHapticFeedback??(()=>{}),le=c.getAssetIDByName("img_none"),ae=t.findByProps("DEFAULT_PROFILE_EFFECT_WH_RATIO")?.DEFAULT_PROFILE_EFFECT_WH_RATIO??45/88,se=c.getAssetIDByName("sample-profile-small")??{uri:"https://discordapp.com/assets/f328a6f8209d4f1f5022.png"},ce=c.getAssetIDByName("toast_copy_link");c.getAssetIDByName("Small");var fe=t.findByProps("Radius")?.Radius??{},de=t.findByProps("Spacing")?.Spacing??{},ue=t.findByProps("SafeAreaContext")?.SafeAreaContext,me=t.findByName("useWindowDimensions")??(()=>{}),pe=3;function ye(e){var{label:t,isSelected:r,size:n,colors:i,onPress:l,style:a,children:s}=e,[c,f,d]=i;return o.createElement(Oe,{accessibilityLabel:t,accessibilityRole:"button",accessibilityState:{selected:r},disabled:r,onPress(){ie(ne.IMPACT_LIGHT),l()},style:[{height:n,width:n,overflow:"hidden",backgroundColor:f,borderColor:c,borderRadius:fe.sm,borderWidth:2},r&&{borderColor:d},a]},s)}function he(e){var{currentEffectId:t,effects:r,onSelect:n}=e,[i,l]=o.useState(t),[c,f]=o.useState(0),{theme:d}=C(),u=o.useMemo((()=>[v(d,g.BACKGROUND_PRIMARY),v(d,g.BACKGROUND_FLOATING),v(d,g.BUTTON_OUTLINE_BRAND_BORDER_ACTIVE)]),[d]),m=me(),p=o.useContext(ue),y=o.useMemo((()=>{for(var e=s.chunk([null,...r],pe),t=e[e.length-1];3>t.length;)t.push(void 0);return e}),[r]);return o.createElement(Pe,{transparentHeader:!0,scrollable:!0,startExpanded:!0,startHeight:m.height-p.top},o.createElement(Se,{scrollsToTop:!1},o.createElement(a.View,{style:{flex:1,flexDirection:"column",alignItems:"center",paddingBottom:88}},o.createElement(ze,{variant:"redesign/heading-18/bold",color:"header-primary",style:{margin:de.PX_16}},t?"Change Effect":"Add Profile Effect"),o.createElement(a.View,{style:{width:"72%",minHeight:38}},o.createElement(ze,{variant:"heading-md/bold",color:"header-primary",style:{textAlign:"center"}},r.find((e=>e.id===i))?.config.title??"None")),o.createElement(a.View,{style:{flex:1,width:"92%",marginTop:3}},o.createElement(Le,{accessibilityLabel:"Profile Effect Selection Section",numColumns:1,estimatedItemSize:98,ItemSeparatorComponent:()=>o.createElement(a.View,{style:{height:de.PX_16}}),contentContainerStyle:{paddingHorizontal:de.PX_4},data:y,extraData:i,renderItem(e){var{item:t}=e;return o.createElement(a.View,{style:{flexDirection:"row",alignItems:"center",justifyContent:"space-between",paddingHorizontal:de.PX_16}},t.map((e=>e?o.createElement(ye,{label:e.config.accessibilityLabel,isSelected:e.id===i,size:c,colors:u,onPress(){l(e.id)}},o.createElement(ke,{effect:e.config})):null===e?o.createElement(ye,{label:"None",isSelected:!i,size:c,colors:u,onPress(){l(void 0)},style:{alignItems:"center",justifyContent:"center"}},o.createElement(De,{source:le,size:De.Sizes.LARGE}),o.createElement(ze,{variant:"text-sm/medium",color:"header-primary",style:{marginTop:de.PX_4}},"None")):o.createElement(a.View,{style:{width:c,height:c}}))))},onLayout(e){f((e.nativeEvent.layout.width-64)/pe)}})))),o.createElement(xe,{text:"Apply",textStyle:{fontSize:16},onPress(){n(r.find((e=>e.id===i))?.config??null)},style:{position:"absolute",right:0,bottom:0,left:0,height:48,marginHorizontal:36,marginBottom:de.PX_48,borderRadius:fe.round}}))}var Ee=t.findByName("showCustomColorPickerActionSheet")??(()=>{});function ge(e){var t;return(t=e).color??(t.color=0),Ee(e)}var ve="__FPTE__",Pe=t.findByProps("BottomSheet")?.BottomSheet??t.findByProps("ActionSheet")?.ActionSheet??(()=>{throw Error("FakeProfileThemesAndEffects threw an error to avoid an otherwise-inevitable, unrecoverable freeze.")}),Se=t.findByProps("BottomSheetScrollView")?.BottomSheetScrollView??(()=>null),Ce=t.findByProps("showActionSheet"),be=Ce?.showActionSheet??(()=>{}),Be=Ce?.default?.hideActionSheet??(()=>{}),Ae=f.Forms.FormSection,Ie=f.Forms.FormRow,Te=f.Forms.FormRadioRow,Ne=f.Forms.FormSwitchRow,we=f.Forms.FormCardSection;function _e(e){var{guildId:t}=e,[r,n]=T(null),[i,s]=_(null),[c,f]=o.useState(null),[u,p]=(e=>{var[t,r]=o.useState((()=>A=!0));return[t,e=>{r(A=e),B()}]})(),[h,S]=o.useState(!1),{theme:b}=C(),[I,N]=o.useMemo((()=>[v(b,g.HEADER_SECONDARY),v(b,g.BACKGROUND_ACCENT)]),[b]),w=P(E.getCurrentUser().getAvatarURL(t,80),N,!1);return o.createElement(we,{title:"FPTE Builder",cardStyle:{backgroundColor:"transparent"}},o.createElement(a.View,{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"}},o.createElement(Re,{fgColor:I,label:"Primary",bgColor:r,onPress(){ge({color:r,onSelect:n,suggestedColors:w})}}),o.createElement(Re,{fgColor:I,label:"Accent",bgColor:i,onPress(){ge({color:i,onSelect:s,suggestedColors:w})}}),o.createElement(Re,{fgColor:I,label:"Effect",onPress(){var e,t;e=f,t=c?.id,m.subscribe("HIDE_ACTION_SHEET",(function e(t){t.key===ve&&(m.unsubscribe("HIDE_ACTION_SHEET",e),F(void 0))})),be({content:o.createElement(re,{effects:y.profileEffects,onSelect(t){e(t),Be(ve)},user:E.getCurrentUser(),currentEffectId:t}),key:ve})}},c&&o.createElement(ke,{effect:c,style:{width:"100%",height:"100%"}})),o.createElement(a.View,{style:{display:"flex",alignItems:"center",flexDirection:"column"}},o.createElement(xe,{text:"Copy FPTE",size:xe.Sizes.SMALL,onPress(){var e,t=((e,t,r,o)=>{var n="";if(o){if(e>=0)return n=L(e,0>t?e:t),r&&(n+=x+O(BigInt(r))),n;if(t>=0)return n=L(t,t),r&&(n+=x+O(BigInt(r))),n}else if(0>e)0>t||(n=H(t));else if(n=H(e),t>=0&&e!==t)return n+=x+H(t),r&&(n+=x+O(BigInt(r))),n;return r&&(n+=x+x+O(BigInt(r))),n})(r??-1,i??-1,c?.id??"",h);t?(e=t,d.setString(e),l.showToast("FPTE copied to clipboard!",ce)):l.showToast("FPTE Builder is empty; nothing to copy!")}}),o.createElement(xe,{text:"Reset",look:xe.Looks.LINK,color:xe.Colors.TRANSPARENT,size:xe.Sizes.SMALL,...null===r&&null===i&&!c&&{pointerEvents:"none",style:{opacity:0}},onPress(){n(null),s(null),f(null)}}))),o.createElement(Ne,{label:"FPTE Builder Preview",value:u,onValueChange:p}),o.createElement(Ne,{label:"Build backwards compatible FPTE",subLabel:"Will use more characters",value:h,onValueChange:S}))}var Fe,Re=e=>{var{label:t,fgColor:r,bgColor:n,onPress:i,children:l}=e;return o.createElement(a.View,{style:{width:50}},o.createElement(Oe,{accessibilityLabel:t,accessibilityRole:"button",onPress:i,style:[{display:"flex",alignItems:"center",justifyContent:"center",height:50,overflow:"hidden",borderColor:r,borderStyle:"dashed",borderWidth:2,borderRadius:fe.xs},null!=n&&{backgroundColor:"#"+n.toString(16).padStart(6,"0"),borderStyle:"solid"},!!l&&{borderWidth:0}]},l??(null==n&&o.createElement(He,{fill:r,width:"40%",height:"40%",viewBox:"0 0 144 144"},o.createElement(Ve,{d:"M144 64H80V0H64v64H0v16h64v64h16V80h64Z"})))),!!t&&o.createElement(ze,{variant:"text-sm/normal",style:{marginTop:de.PX_4,textAlign:"center"}},t))},xe=f.Button,De=t.findByProps("IconSizes")?.default??(()=>null),ke=e=>{var{effect:t,style:r}=e;return o.createElement(a.View,{style:r},o.createElement(a.Image,{resizeMode:"cover",source:se,style:{width:"100%",height:"100%"}}),o.createElement(a.Image,{alt:t.accessibilityLabel,resizeMethod:"resize",resizeMode:"cover",source:{uri:t.thumbnailPreviewSrc},style:{position:"absolute",width:"100%",aspectRatio:ae}}))},ze=t.findByProps("TextStyleSheet")?.Text??(()=>null),Le=t.findByName("FlashList")??(()=>null),Ue=t.findByProps("Svg"),He=Ue?.Svg??(()=>null),Ve=Ue?.Path??(()=>null),Oe=t.findByProps("PressableOpacity")?.PressableOpacity??(()=>null),Me=t.findByName("GuildProfileEditForm",!1),Ge=t.findByPropsAll("NONE_ITEM"),We=t.findByName("UserProfileEditForm",!1);function Xe(){var e=E.getCurrentUser();if(e){var t=h.getUserProfile(e.id);t&&m.dispatch({type:"USER_PROFILE_FETCH_SUCCESS",user:e,user_profile:t,connected_accounts:t.connectedAccounts})}}var je=[],Ke={onLoad(){je.push(r.instead("getPurchase",p,((e,t)=>N?{purchasedAt:new Date}:t(e))),r.after("getUserProfile",h,((e,t)=>{if(!t)return t;if(i.storage.prioritizeNitro){if(t.themeColors){if(!t.profileEffectId&&!t.profileEffectID){var r=G(t.bio);-2===V(r[0])?X(t,M(r[1])):X(t,M(r[2]))}return t}if(t.profileEffectId||t.profileEffectID){var o=G(t.bio),n=V(o[0]);return-2===n?W(t,...U(o[0])):W(t,n,V(o[1])),t}}var l=G(t.bio),a=V(l[0]);return-2===a?(W(t,...U(l[0])),X(t,M(l[1]))):(W(t,a,V(l[1])),X(t,M(l[2]))),t})),r.after("default",Me,((e,t)=>{if(i.storage.hideBuilder)return t;var r,n=Q(t,(e=>Array.isArray(e)&&e.some((e=>!(!Y(e)||"EditGuildIdentityBio"!==q(e.type)||(r=e.props.displayProfile?.guildId,0))))));return n&&n.props.children.splice(2,0,o.createElement(_e,{guildId:r})),t})),...Ge.map((e=>r.after("default",e,((e,t)=>(N&&(void 0!==y.profileEffects?(t.splice(1),t[0].items.splice(1),y.profileEffects.forEach((e=>{t[0].items.push(new ee(e))})),Fe=t):t=Fe),t))))),R(),r.after("default",We,((e,t)=>{if(i.storage.hideBuilder)return t;var r=Q(t,(e=>Array.isArray(e)&&e.some((e=>Y(e)&&"EditUserProfileBio"===q(e.type)))));return r&&r.props.children.splice(2,0,o.createElement(_e,null)),t}))),Xe()},onUnload(){je.forEach((e=>{e()})),Xe()},settings:()=>(u.useProxy(i.storage),o.createElement(a.ScrollView,null,o.createElement(Ae,{title:"Settings"},o.createElement(Ie,{label:"Source to prioritize"}),o.createElement(Te,{label:"Nitro",selected:!!i.storage.prioritizeNitro,onPress(){i.storage.prioritizeNitro=!0}}),o.createElement(Te,{label:"About Me",selected:!i.storage.prioritizeNitro,onPress(){i.storage.prioritizeNitro=!1}}),o.createElement(Ne,{label:"Hide Builder",subLabel:"Hide the FPTE Builder in the User Profile and Server Profiles settings pages",value:!!i.storage.hideBuilder,onValueChange(e){i.storage.hideBuilder=e}}),o.createElement(Ne,{label:"Force fallback effect picker",value:!!i.storage.forceFallbackEffectPicker,onValueChange(e){i.storage.forceFallbackEffectPicker=e}}))))};return Ke})(vendetta.metro.common,vendetta.metro,vendetta.patcher,React,vendetta.ui,vendetta.plugin,vendetta.ui.toasts,vendetta.metro.common.ReactNative,vendetta.metro.common.lodash,vendetta.ui.assets,vendetta.ui.components,vendetta.metro.common.clipboard,vendetta.storage);
