(function(I,ie,oe,D,A,M,r,d,B,u,_,E,N,O,se){"use strict";var De={github:{url:"https://github.com/nexpid/DettaPlugins/",raw:"https://raw.githubusercontent.com/nexpid/DettaPlugins/main/"}};const at=d.find(function(e){return e?.WebView&&!e.default}).WebView;d.findByProps("SvgXml"),d.findByProps("isJoi"),d.findByProps("useSharedValue");const L=r.ReactNative.NativeModules.DCDFileManager??r.ReactNative.NativeModules.RTNFileManager,it=r.ReactNative.NativeModules.BundleUpdaterManager,ot=r.ReactNative.NativeModules.MMKVManager,q=r.ReactNative.NativeModules.DCDSoundManager,w=r.ReactNative.NativeModules.RNFSManager,U=function(e){return e.startsWith("file://")?e.slice(7):e},ce=function(e){if(typeof e=="string"){if(["utf8","ascii","base64"].includes(e))return{encoding:e};throw new Error(`Invalid encoding type "${String(e)}"`)}else return e||{encoding:"utf8"}},st=function(e,t,n){const i=ce(t);return n(U(e)).then(function(o){let s;return i.encoding==="utf8"?s=Buffer.from(o,"base64").toString("utf8"):i.encoding==="ascii"?s=Buffer.from(o,"base64").toString("ascii"):i.encoding==="base64"&&(s=o),s})},Ae=function(e){let t={style:null,path:null};const n=L.getConstants();if(e.startsWith(n.DocumentsDirPath))t={style:"documents",path:e.slice(n.DocumentsDirPath.length+1)};else if(e.startsWith(n.CacheDirPath))t={style:"cache",path:e.slice(n.CacheDirPath.length+1)};else throw new Error(`File path "${String(e)}" is unsupported on versions <211.6 (not a caches/documents path, missing RNFS)`);return t},v={unlink(e){if(w)return w.unlink(U(e)).then(function(){});const t=Ae(e);return L.removeFile(t.style,t.path).then(function(){})},exists(e){return w?w.exists(U(e)):L.fileExists(U(e))},readFile(e,t){if(w)return st(e,t,w.readFile);{const n=ce(t);if(n.encoding==="ascii")throw new Error('Encoding type "ascii" is unsupported on versions <211.6 (missing RNFS)');return L.readFile(e,n.encoding)}},writeFile(e,t,n){const i=ce(n);if(!w){if(i.encoding==="ascii")throw new Error('Encoding type "ascii" is unsupported on versions <211.6 (missing RNFS)');const s=Ae(e);return L.writeFile(s.style,s.path,t,i.encoding).then(function(){})}let o;return i.encoding==="utf8"?o=Buffer.from(t,"utf8").toString("base64"):i.encoding==="ascii"?o=Buffer.from(t,"ascii").toString("base64"):i.encoding==="base64"&&(o=t),w.writeFile(U(e),o,i)},mkdir(e){if(!w)throw new Error("Function 'mkdir' is unsupported on versions <211.6 (missing RNFS)");return w.mkdir(U(e),{}).then(function(){})},MainBundlePath:w?.RNFSMainBundlePath,get CachesDirectoryPath(){return w?.RNFSCachesDirectoryPath??L.getConstants().CacheDirPath},ExternalCachesDirectoryPath:w?.RNFSExternalCachesDirectoryPath,get DocumentDirectoryPath(){return w?.RNFSDocumentDirectoryPath??L.getConstants().DocumentsDirPath},DownloadDirectoryPath:w?.RNFSDownloadDirectoryPath,ExternalDirectoryPath:w?.RNFSExternalDirectoryPath,ExternalStorageDirectoryPath:w?.RNFSExternalStorageDirectoryPath,TemporaryDirectoryPath:w?.RNFSTemporaryDirectoryPath,LibraryDirectoryPath:w?.RNFSLibraryDirectoryPath,PicturesDirectoryPath:w?.RNFSPicturesDirectoryPath,FileProtectionKeys:w?.RNFSFileProtectionKeys,RoamingDirectoryPath:w?.RNFSRoamingDirectoryPath,hasRNFS:!!w};function ct(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Be(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function lt(e,t,n){return t&&Be(e.prototype,t),n&&Be(e,n),e}function Q(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const ut=`${De.github.raw}lang/values/`,ft=function(){return v.hasRNFS&&v.mkdir(`${v.DocumentDirectoryPath}/vendetta/NexpidLang`)},le=function(e){return`${v.DocumentDirectoryPath}/vendetta/NexpidLang/${e}.json`},ue=function(e){return`${v.DocumentDirectoryPath}/vendetta/NexpidLang/${e}_etag.txt`};let dt=function(){function e(t){ct(this,e),Q(this,"plugin",void 0),Q(this,"values",void 0),Q(this,"controller",void 0),Q(this,"Values",void 0),this.plugin=t,this.values=null,this.controller=new AbortController,this.load()}return lt(e,[{key:"load",value:async function(){var t=this;const n=async function(){if(await v.exists(le(t.plugin)))try{t.values=JSON.parse(await v.readFile(le(t.plugin)))}catch{return}};{const i=await fetch(`${ut}${this.plugin}.json`,{headers:{"cache-control":"public, max-age=20"}});if(!i.ok)return n();ft();const o=await v.exists(ue(this.plugin))&&await v.readFile(ue(this.plugin)),s=i.headers.get("etag");if(!s)return n();if(s!==o){v.writeFile(ue(this.plugin),s);const c=await i.text();v.writeFile(le(this.plugin),c);try{this.values=JSON.parse(c)}catch{return}}else n()}}},{key:"unload",value:function(){this.controller.abort()}},{key:"format",value:function(t,n,i){const o=i,s=t;if(!this.values)return String(s);let c=this.values[e.getLang()]?.[s]??this.values.en?.[s]??o;if(!c)return String(s);const g=c.match(/\$\w+/g)?.map(function(l){return l.slice(1)})??[];for(const l of g)c=c.replace(new RegExp(`\\$${l}`,"g"),String(l in n?n[l]:""));return c}}],[{key:"getLang",value:function(){const t=r.i18n.getLocale()?.replace(/-/g,"_")??"en";return t.startsWith("en_")?"en":t}}]),e}();const gt=d.findByStoreName("ThemeStore");d.findByProps("triggerHaptic");const xe=d.findByProps("colors","unsafe_rawColors"),pt=xe?.internal??xe?.meta,fe=d.findByProps("TextStyleSheet").TextStyleSheet,ht=d.findByProps("ActionSheet")?.ActionSheet??d.find(function(e){return e.render?.name==="ActionSheet"}),yt=d.findByProps("openLazy","hideActionSheet"),{openLazy:mt,hideActionSheet:$e}=yt,{ActionSheetTitleHeader:Rt,ActionSheetCloseButton:St,ActionSheetContentContainer:wt}=d.findByProps("ActionSheetTitleHeader","ActionSheetCloseButton","ActionSheetContentContainer");d.findByProps("ActionSheetRow")?.ActionSheetRow,d.findByName("Navigator")??d.findByProps("Navigator")?.Navigator,d.findByProps("getRenderCloseButton")?.getRenderCloseButton??d.findByProps("getHeaderCloseButton")?.getHeaderCloseButton,d.findByProps("popModal","pushModal");const Et=d.findByProps("Button","ContextMenu","TextInput")??{};function _t(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:gt.theme;return pt.resolveSemanticColor(t,e)}function de(e,t){try{mt(new Promise(function(n){return n({default:e})}),"ActionSheet",t)}catch(n){ie.logger.error(n.stack),E.showToast("Got error when opening ActionSheet! Please check debug logs",u.getAssetIDByName("Smal"))}}const{Text:vt}=_.General;function Z(e){let{variant:t,lineClamp:n,color:i,align:o,style:s,onPress:c,getChildren:g,children:l,liveUpdate:S}=e;const[p,h]=r.React.useReducer(function(y){return~y},0);return r.React.useEffect(function(){if(!S)return;const y=new Date().setMilliseconds(1e3);let m;const C=setTimeout(function(){h(),m=setInterval(h,1e3)},y-Date.now());return function(){clearTimeout(C),clearInterval(m)}},[]),r.React.createElement(vt,{style:[t?fe[t]:{},i?{color:_t(N.semanticColors[i])}:{},o?{textAlign:o}:{},s??{}],numberOfLines:n,onPress:c},g?.()??l)}const{View:z,Pressable:Nt}=_.General;function bt(e){let{title:t,onPress:n,icon:i}=e;const o=r.stylesheet.createThemedStyleSheet({androidRipple:{color:N.semanticColors.ANDROID_RIPPLE},icon:{height:18,tintColor:N.semanticColors.HEADER_SECONDARY,opacity:.5}}),s=n?Nt:z;return React.createElement(s,{android_ripple:o.androidRipple,disabled:!1,accessibilityRole:"button",onPress:n,style:{marginBottom:8,flexDirection:"row",justifyContent:"flex-start",alignItems:"center"}},i&&React.createElement(z,{style:{marginRight:4}},React.createElement(r.ReactNative.Image,{style:o.icon,source:i,resizeMode:"contain"})),React.createElement(Z,{variant:"text-sm/semibold",color:"HEADER_SECONDARY"},t))}function ee(e){let{title:t,onTitlePress:n,icon:i,children:o,padding:s}=e;const c=r.stylesheet.createThemedStyleSheet({main:{backgroundColor:N.semanticColors.CARD_PRIMARY_BG,borderRadius:16,overflow:"hidden",flex:1}});return React.createElement(z,{style:{marginHorizontal:16,marginTop:16}},React.createElement(bt,{title:t,onPress:n,icon:i}),React.createElement(z,{style:c.main},s?React.createElement(z,{style:{paddingHorizontal:16,paddingVertical:16}},o):o))}const{View:Fe}=_.General;function ke(e){let{addPadding:t}=e;const n=r.stylesheet.createThemedStyleSheet({line:{width:"100%",height:2,backgroundColor:N.semanticColors.BACKGROUND_ACCENT,borderRadius:2147483647}});return React.createElement(Fe,{style:[{marginTop:16,marginBottom:16},t&&{marginHorizontal:16}]},React.createElement(Fe,{style:n.line}))}const ge="https://cloudsync.nexpid.xyz/",pe="1120793656878714913",Me=function(){return f.host?f.host.endsWith("/")?f.host:`${f.host}/`:ge};var T={get api(){return Me()},raw:`${De.github.raw}plugins/cloud-sync/`,oauth2:{get clientId(){return f.clientId||pe},get redirectURL(){return`${Me()}api/oauth2-response`}}};function Pt(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Tt(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function te(e,t,n){return Oe()?te=Reflect.construct:te=function(i,o,s){var c=[null];c.push.apply(c,o);var g=Function.bind.apply(i,c),l=new g;return s&&K(l,s.prototype),l},te.apply(null,arguments)}function H(e){return H=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},H(e)}function Ct(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&K(e,t)}function It(e){return Function.toString.call(e).indexOf("[native code]")!==-1}function Dt(e,t){return t&&(At(t)==="object"||typeof t=="function")?t:Pt(e)}function K(e,t){return K=Object.setPrototypeOf||function(n,i){return n.__proto__=i,n},K(e,t)}function At(e){"@swc/helpers - typeof";return e&&typeof Symbol<"u"&&e.constructor===Symbol?"symbol":typeof e}function he(e){var t=typeof Map=="function"?new Map:void 0;return he=function(n){if(n===null||!It(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof t<"u"){if(t.has(n))return t.get(n);t.set(n,i)}function i(){return te(n,arguments,H(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),K(i,n)},he(e)}function Oe(){if(typeof Reflect>"u"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch{return!1}}function Bt(e){var t=Oe();return function(){var n=H(e),i;if(t){var o=H(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return Dt(this,i)}}const Le=d.findByStoreName("UserStore");let V=function(e){Ct(n,e);var t=Bt(n);function n(i){Tt(this,n);var o;return o=t.call(this,`${i.status}: ${i.message}${i.error?` (${i.error})`:""}`),o.name=o.constructor.name,o}return n}(he(Error));function x(){return f.auth[Le.getCurrentUser()?.id]}async function ye(){const e=new Error(a.format("toast.api.unauthorized",{}));let t=x();if(!t)throw e;if(Date.now()>=t.expiresAt){const n=await fetch(`${T.api}api/refresh-access-token?refresh_token=${encodeURIComponent(t.refreshToken)}`);if(n.status!==200)throw new V(await n.json());t=await n.json(),f.auth[Le.getCurrentUser().id]=t}return t.accessToken}async function xt(e){const t=await fetch(`${T.api}api/get-access-token?code=${encodeURIComponent(e)}`);if(t.status===200)return await t.json();throw new V(await t.json())}async function $t(){if(!x())return;const e=await fetch(`${T.api}api/get-data`,{headers:{authorization:await ye()}});if(e.status===200)return await e.json();throw new V(await e.json())}async function Ge(e){if(!x())return;const t=await fetch(`${T.api}api/sync-data`,{method:"POST",headers:{authorization:await ye(),"content-type":"application/json"},body:JSON.stringify(e)});if(t.status===200)return await t.json();throw new V(await t.json())}async function Ft(){if(!x())return;const e=await fetch(`${T.api}api/delete-data`,{method:"DELETE",headers:{authorization:await ye()}});if(e.status===200)return await e.json();throw new V(await e.json())}async function kt(e){if(!x())return;const t=await fetch("https://hst.sh/documents",{method:"POST",body:e});if(t.status===200)return await t.json();throw new V(await t.json())}const{pushModal:Mt,popModal:Ot}=d.findByProps("pushModal","popModal"),Lt=d.findByName("OAuth2AuthorizeModal"),Gt=d.findByStoreName("UserStore");function jt(){Mt({key:"oauth2-authorize",modal:{key:"oauth2-authorize",modal:Lt,animation:"slide-up",shouldPersistUnderModals:!1,props:{clientId:T.oauth2.clientId,redirectUri:T.oauth2.redirectURL,scopes:["identify"],responseType:"code",permissions:0n,cancelCompletesFlow:!1,callback:async function(e){let{location:t}=e;if(t)try{const n=new URL(t).searchParams.get("code"),i=await xt(n);f.auth[Gt.getCurrentUser().id]=i,be(),E.showToast(a.format("toast.oauth.authorized",{}),u.getAssetIDByName("Check"))}catch(n){E.showToast(String(n),u.getAssetIDByName("Small"))}},dismissOAuthModal:function(){return Ot("oauth2-authorize")}},closable:!0}})}async function je(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const n=Math.floor(Math.random()*1e6),i=await Promise.resolve(new Promise(function(s){return q.prepare(e,"notification",n,function(c,g){return s(g?.duration??t)})}));let o=null;return{play(){o&&(clearTimeout(o),o=null,q.stop(n)),q.play(n),o=setTimeout(function(){o=null,q.stop(n)},i)}}}let ne=!1,me;const Re=[];function Ut(){Re.length=0,me?.()}function G(e,t){Re.push([e,t]),me?.()}const Vt={themes:"#42f5a4",plugins:"#4290f5",importer:"#e6f542"},Ue=r.stylesheet.createThemedStyleSheet({text:{fontFamily:r.constants.Fonts.CODE_SEMIBOLD,includeFontPadding:!1,color:N.semanticColors.TEXT_NORMAL,marginHorizontal:12,marginTop:24}}),zt=function(){const[e,t]=r.React.useReducer(function(i){return~i},0);me=t;const n=r.React.useRef();return r.React.useEffect(function(){return ne=!0,function(){ne=!1}},[]),r.React.createElement(r.ReactNative.ScrollView,{style:{flex:1},ref:n,onContentSizeChange:function(){return n.current.scrollToEnd({animated:!0})}},r.React.createElement(r.ReactNative.Text,{style:Ue.text},Re.map(function(i){let[o,s]=i;return[r.React.createElement(r.ReactNative.Text,{style:[Ue.text,{color:Vt[o]}]},"[",a.format(`log.${o}`,{}),"]:"),` ${s}
`]})))};function Ht(e){e.push("VendettaCustomPage",{render:zt,title:a.format("page.import_logs",{})})}async function Ve(){const e={themes:[],plugins:[]};for(const t of Object.values(D.plugins)){const n=f.pluginSettings[t.id];if(n?.syncPlugin===!1)continue;const i=n?.syncStorage===!1?{}:await A.createMMKVBackend(t.id).get();e.plugins.push({id:t.id,enabled:t.enabled,options:i})}for(const t of Object.values(M.themes))e.themes.push({id:t.id,enabled:t.selected});return e}let re;function ze(e){re=e}const P=function(e){return e!==1?a.format("combo.plugins.plural",{count:e}):a.format("combo.plugins",{})};async function Kt(e,t){if(!e)return;re?.(!0);const n=[...e.sync.plugins.filter(function(c){return!D.plugins[c.id]&&!J(c.id)&&X(c.id)&&t.unproxiedPlugins}),...e.sync.plugins.filter(function(c){return!D.plugins[c.id]&&J(c.id)&&X(c.id)&&t.plugins})],i=e.sync.themes.filter(function(c){return!M.themes[c.id]&&t.themes});if(!n[0]&&!i[0])return re?.(!1),E.showToast(a.format("toast.sync.no_import",{}),u.getAssetIDByName("Small"));Ut(),G("importer",a.format("log.import.start.combo",{plugins:P(n.length),themes:P(i.length)})),ne||E.showToast(a.format("log.import.start.combo",{plugins:P(n.length),themes:P(i.length)}),u.getAssetIDByName("toast_image_saved"));const o={plugins:0,themes:0,fPlugins:0,fThemes:0};await Promise.all([...n.map(function(c){return new Promise(function(g){ot.setItem(c.id,JSON.stringify(c.options)),D.installPlugin(c.id,c.enabled).then(function(){o.plugins++,G("plugins",a.format("log.import.plugin.success",{name:c.id}))}).catch(function(l){o.fPlugins++,G("plugins",a.format("log.import.plugin.fail",{name:c.id,error:l}))}).finally(g)})}),...i.map(function(c){return new Promise(function(g){return M.installTheme(c.id).then(function(){o.themes++,G("themes",a.format("log.import.theme.success",{name:c.id}))}).catch(function(l){o.fThemes++,G("themes",a.format("log.import.theme.fail",{name:c.id,error:l}))}).finally(g)})})]),ne||E.showToast(a.format("log.import.total",{plugins:P(o.plugins),themes:P(o.themes)}),u.getAssetIDByName("Check"));const s=M.themes[i.find(function(c){return c.enabled})?.id];s&&(G("themes",a.format("log.import.select_theme",{theme:s.id})),await A.createFileBackend("vendetta_theme.json").set(Object.assign(s,{selected:!0})),await function(){return new Promise(function(c){return B.showConfirmationAlert({title:a.format("alert.change_theme.title",{}),content:a.format("alert.change_theme.body",{}),confirmText:a.format("alert.change_theme.confirm",{}),confirmColor:"red",onConfirm:function(){it.reload(),c()},cancelText:a.format("alert.change_theme.cancel",{}),onCancel:c,isDismissable:!0})})}()),G("importer",o.fPlugins||o.fThemes?a.format("log.import.result.fail",{plugins:P(o.plugins),themes:P(o.themes),failed_plugins:P(o.fPlugins),failed_themes:P(o.fThemes)}):a.format("log.import.result.success",{plugins:P(o.plugins),themes:P(o.themes)})),re?.(!1)}var Wt=`<!doctype html>
<html></html>
<script>
  const RNWV = window.ReactNativeWebView;

  const stringToBuffer = (string) => new TextEncoder().encode(string);
  const bufferToString = (buffer) => new TextDecoder().decode(buffer);

  const keyCache = {};
  const getKey = async (raw) => {
    if (keyCache[raw]) return keyCache[raw];

    const pkey = await crypto.subtle.importKey(
      "raw",
      stringToBuffer(raw),
      { name: "PBKDF2" },
      false,
      ["deriveKey"],
    );
    const key = await crypto.subtle.deriveKey(
      {
        name: "PBKDF2",
        salt: new Uint8Array(16),
        iterations: 100000,
        hash: "SHA-256",
      },
      pkey,
      { name: "AES-GCM", length: 256 },
      false,
      ["encrypt", "decrypt"],
    );
    keyCache[raw] = key;
    return key;
  };

  window.addEventListener("message", async (ev) => {
    const { action, data, key, tracker } = ev.data;
    if (!action || !data || !key || !tracker) return;

    try {
      if (action === "encrypt") {
        const iv = crypto.getRandomValues(new Uint8Array(12));
        const ret = await window.crypto.subtle.encrypt(
          {
            name: "AES-GCM",
            iv,
          },
          await getKey(key),
          stringToBuffer(data),
        );
        return RNWV.postMessage(
          JSON.stringify({
            tracker,
            data: btoa(
              String.fromCharCode
                .apply(null, iv)
                .concat(String.fromCharCode.apply(null, new Uint8Array(ret))),
            ),
          }),
        );
      } else if (action === "decrypt") {
        const raw = atob(data);
        const iv = new Uint8Array(
          raw
            .slice(0, 12)
            .split("")
            .map((x) => x.charCodeAt(0)),
        );
        const dt = new Uint8Array(
          raw
            .slice(12)
            .split("")
            .map((x) => x.charCodeAt(0)),
        );

        const ret = await window.crypto.subtle.decrypt(
          {
            name: "AES-GCM",
            iv,
          },
          await getKey(key),
          dt,
        );
        return RNWV.postMessage(
          JSON.stringify({ tracker, data: bufferToString(ret) }),
        );
      }
    } catch (e) {
      return RNWV.postMessage(
        JSON.stringify({ tracker, error: e.message ?? \`\${e}\` }),
      );
    }
  });
<\/script>`;let W;const Se={},He=function(){return Math.floor(Math.random()*1e36).toString(36)},Ke=function(e){return W?.injectJavaScript(`window.postMessage(${JSON.stringify(e)})`)};async function Jt(e,t){if(!W)return null;const n=He();return new Promise(function(i,o){Se[n]=function(s){return"error"in s?o(s.error):i(s.data)},Ke({action:"encrypt",data:e,key:t,tracker:n})})}async function Xt(e,t){if(!W)return null;const n=He();return new Promise(function(i,o){Se[n]=function(s){return"error"in s?o(s.error):i(s.data)},Ke({action:"decrypt",data:e,key:t,tracker:n})})}function Yt(){return r.React.useEffect(function(){return function(){return W=void 0}},[]),r.React.createElement(at,{ref:function(e){return W=e},source:{html:Wt,baseUrl:"https://localhost"},style:{display:"none",opacity:0},onMessage:function(e){let{nativeEvent:{data:t}}=e,n;try{n=JSON.parse(t)}catch{return}Se[n.tracker]?.(n)}})}const{View:qt,Text:We}=_.General,Je=r.stylesheet.createThemedStyleSheet({count:{...fe["text-lg/bold"],color:N.semanticColors.TEXT_NORMAL,textAlign:"center"},subtitle:{...fe["text-md/medium"],color:N.semanticColors.TEXT_MUTED,textAlign:"center"}});function Xe(e){let{subtitle:t,count:n}=e;return React.createElement(qt,{style:{alignItems:"center",justifyContent:"center",marginHorizontal:16}},React.createElement(We,{style:Je.count},n),React.createElement(We,{style:Je.subtitle},a.format(t,{})))}function Qt(e){let{onPress:t,onLongPress:n,icon:i,style:o,destructive:s,color:c}=e;const g=r.stylesheet.createThemedStyleSheet({headerStyleIcon:{width:24,height:24,marginRight:10,tintColor:N.semanticColors.HEADER_PRIMARY},cardStyleIcon:{width:22,height:22,marginLeft:5,tintColor:N.semanticColors.INTERACTIVE_NORMAL},destructiveIcon:{tintColor:N.semanticColors.TEXT_DANGER}});return React.createElement(r.ReactNative.TouchableOpacity,{onPress:t,onLongPress:n},React.createElement(r.ReactNative.Image,{style:[typeof o=="string"?o==="header"?g.headerStyleIcon:g.cardStyleIcon:o,s&&g.destructiveIcon,c&&{tintColor:c}].filter(function(l){return!!l}),source:i}))}const{FormSwitchRow:Ye}=_.Forms;function Zt(){const[e,t]=r.React.useState(""),[,n]=r.React.useReducer(function(s){return~s},0);r.React.useEffect(function(){t("")},[]),A.useProxy(f);const i=r.NavigationNative.useNavigation(),o=i.addListener("focus",function(){o(),i.setOptions({title:a.format("page.plugin_settings.title",{}),headerRight:function(){return r.React.createElement(Qt,{onPress:function(){return B.showConfirmationAlert({title:a.format("alert.plugin_settings_revert.title",{}),content:a.format("alert.plugin_settings_revert.body",{}),confirmText:a.format("alert.plugin_settings_revert.confirm",{}),confirmColor:"red",onConfirm:function(){return f.pluginSettings={}}})},icon:u.getAssetIDByName("ic_message_delete"),style:"header"})}})});return r.React.createElement(r.ReactNative.FlatList,{ListHeaderComponent:r.React.createElement(_.Search,{style:{marginBottom:10},onChangeText:function(s){return t(s.toLowerCase())}}),style:{paddingHorizontal:10,paddingTop:10},contentContainerStyle:{paddingBottom:20},data:Object.entries(D.plugins).filter(function(s){return s[1].manifest.name?.toLowerCase().includes(e)}),renderItem:function(s){let{item:[c,g]}=s;const l=f.pluginSettings[c]??{syncPlugin:!0,syncStorage:!0},S=function(){l.syncPlugin===!0&&l.syncStorage===!0?delete f.pluginSettings[c]:f.pluginSettings[c]=l,n()};return r.React.createElement(_.Summary,{label:g.manifest.name,icon:g.manifest.vendetta.icon??":3"},r.React.createElement(Ye,{label:a.format("page.plugin_settings.sync_plugin",{}),onValueChange:function(){l.syncPlugin=!l.syncPlugin,S()},value:l.syncPlugin}),r.React.createElement(Ye,{label:a.format("page.plugin_settings.sync_plugin_storage",{}),onValueChange:function(){l.syncStorage=!l.syncStorage,S()},value:l.syncStorage}))}})}const{View:en}=_.General,{FormCheckboxRow:we}=_.Forms;function Ee(e){let{defOptions:t,save:n=b.save,navigation:i}=e;const o={unproxiedPlugins:n.sync.plugins.filter(function(S){return!D.plugins[S.id]&&!J(S.id)&&X(S.id)}).length,plugins:n.sync.plugins.filter(function(S){return!D.plugins[S.id]&&J(S.id)&&X(S.id)}).length,themes:n.sync.themes.filter(function(S){return!M.themes[S.id]}).length},s=[o.unproxiedPlugins,o.plugins,o.themes].reduce(function(S,p){return S+p},0),[c,g]=r.React.useState(t??{unproxiedPlugins:!1,plugins:!!o.plugins,themes:!!o.themes}),l=r.stylesheet.createThemedStyleSheet({icon:{width:18,height:18,tintColor:N.semanticColors.TEXT_BRAND,marginRight:4},btnIcon:{tintColor:N.semanticColors.TEXT_NORMAL,marginRight:8}});return r.React.createElement(ht,null,r.React.createElement(wt,null,r.React.createElement(Rt,{title:a.format("sheet.import_data.title",{}),trailing:r.React.createElement(St,{onPress:function(){return $e()}})}),!s&&r.React.createElement(r.React.Fragment,null,r.React.createElement(en,{style:{flexDirection:"row",alignItems:"center",justifyContent:"center",marginTop:8}},r.React.createElement(r.ReactNative.Image,{source:u.getAssetIDByName("ic_info_24px"),style:l.icon,resizeMode:"cover"}),r.React.createElement(Z,{variant:"text-md/semibold",color:"TEXT_BRAND",align:"center"},a.format("sheet.import_data.already_synced",{})))),r.React.createElement(we,{label:`Unproxied Plugins (${o.unproxiedPlugins})`,disabled:!o.unproxiedPlugins,onPress:function(){return o.unproxiedPlugins&&(!c.unproxiedPlugins&&!t?B.showConfirmationAlert({title:a.format("alert.unproxied_plugin_warn.title",{}),content:a.format("alert.unproxied_plugin_warn.body",{}),isDismissable:!0,confirmText:a.format("alert.unproxied_plugin_warn.confirm",{}),confirmColor:"brand",onConfirm:function(){return de(Ee,{save:n,navigation:i,defOptions:{...c,unproxiedPlugins:!0}})}}):g({...c,unproxiedPlugins:!c.unproxiedPlugins}))},selected:c.unproxiedPlugins}),r.React.createElement(we,{label:a.format("sheet.import_data.plugins",{count:o.plugins}),disabled:!o.plugins,onPress:function(){return o.plugins&&g({...c,plugins:!c.plugins})},selected:c.plugins}),r.React.createElement(we,{label:a.format("sheet.import_data.themes",{count:o.themes}),disabled:!o.themes,onPress:function(){return o.themes&&g({...c,themes:!c.themes})},selected:c.themes}),r.React.createElement(Et.Button,{text:a.format("sheet.import_data.import",{}),variant:"primary",size:"md",iconPosition:"start",icon:u.getAssetIDByName("DownloadIcon"),onPress:function(){Ht(i),Kt(n,c),$e()},style:{marginHorizontal:16,marginVertical:16},disabled:!c.unproxiedPlugins&&!c.plugins&&!c.themes})))}const _e=d.findByProps("pickSingle","isCancel"),{downloadMediaAsset:tn}=d.findByProps("downloadMediaAsset"),{ScrollView:nn,View:qe}=_.General,{FormRow:R,FormInput:Qe,FormSwitchRow:Ze}=_.Forms,et=d.findByStoreName("UserStore"),rn=A.wrapSync(je(`${T.raw}assets/snd_creepyjingle.ogg`,1.6)),an=A.wrapSync(je(`${T.raw}assets/snd_mysterygo.ogg`,2.2));function ve(){const[e,t]=r.React.useState(!1),[n,i]=r.React.useState([]);A.useProxy(b),A.useProxy(f);const o=function(p){return!n.includes(p)&&i([...n,p])},s=function(p){return i(n.filter(function(h){return p!==h}))};let c=0;const g=r.NavigationNative.useNavigation(),l=!!x(),S=!!b.save;return r.React.createElement(nn,null,r.React.createElement(Yt,null),r.React.createElement(ee,{title:a.format("settings.current_data.title",{}),icon:u.getAssetIDByName("ic_contact_sync"),padding:!0},r.React.createElement(qe,{style:{flexDirection:"row",alignItems:"center",justifyContent:"center",marginVertical:8}},r.React.createElement(Xe,{count:b.save?.sync?.plugins?.length??"-",subtitle:"settings.current_data.plugins"}),r.React.createElement(Xe,{count:b.save?.sync?.themes?.length??"-",subtitle:"settings.current_data.themes"}))),r.React.createElement(ee,{title:a.format("settings.config.title",{}),icon:u.getAssetIDByName("ic_cog_24px"),onTitlePress:function(){return c>=Date.now()?(e?an.play():rn.play(),t(!e),c=0):c=Date.now()+500}},r.React.createElement(Ze,{label:a.format("settings.config.auto_save.title",{}),subLabel:a.format("settings.config.auto_save.description",{}),leading:r.React.createElement(R.Icon,{source:u.getAssetIDByName("ic_contact_sync")}),onValueChange:function(){return f.autoSync=!f.autoSync},value:f.autoSync}),!Pe&&f.autoSync&&r.React.createElement(Z,{variant:"text-md/semibold",color:"TEXT_DANGER",style:{marginHorizontal:20,marginVertical:2}},"You must reinstall your client in order to use Auto Save!"),r.React.createElement(Ze,{label:a.format("settings.config.settings_pin.title",{}),subLabel:a.format("settings.config.settings_pin.description",{}),leading:r.React.createElement(R.Icon,{source:u.getAssetIDByName("ic_message_pin")}),onValueChange:function(){return f.addToSettings=!f.addToSettings},value:f.addToSettings}),r.React.createElement(R,{label:a.format("page.plugin_settings.title",{}),leading:r.React.createElement(R.Icon,{source:u.getAssetIDByName("debug")}),trailing:r.React.createElement(R.Arrow,null),onPress:function(){return g.push("VendettaCustomPage",{render:Zt})}}),e&&r.React.createElement(r.React.Fragment,null,r.React.createElement(ke,{addPadding:!0}),r.React.createElement(R,{label:a.format("settings.dev.api_url.title",{}),subLabel:a.format("settings.dev.api_url.description",{}),leading:r.React.createElement(R.Icon,{source:u.getAssetIDByName("ic_message_edit")})}),r.React.createElement(Qe,{title:"",placeholder:ge,value:T.api,onChange:function(p){return f.host=p||ge},style:{marginTop:-25,marginHorizontal:12}}),r.React.createElement(R,{label:a.format("settings.dev.client_id.title",{}),subLabel:a.format("settings.dev.client_id.description",{}),leading:r.React.createElement(R.Icon,{source:u.getAssetIDByName("ic_message_edit")})}),r.React.createElement(Qe,{title:"",placeholder:pe,value:T.oauth2.clientId,onChange:function(p){return f.clientId=p||pe},style:{marginTop:-25,marginHorizontal:12}}))),r.React.createElement(ee,{title:a.format("settings.auth.title",{}),icon:u.getAssetIDByName("lock")},x()?r.React.createElement(r.React.Fragment,null,r.React.createElement(R,{label:a.format("settings.auth.log_out.title",{}),subLabel:a.format("settings.auth.log_out.description",{}),leading:r.React.createElement(R.Icon,{source:u.getAssetIDByName("ic_logout_24px")}),onPress:function(){return B.showConfirmationAlert({title:a.format("alert.log_out.title",{}),content:a.format("alert.log_out.body",{}),confirmColor:"BRAND",onConfirm:function(){delete f.auth[et.getCurrentUser().id],delete b.save,E.showToast(a.format("toast.logout",{}),u.getAssetIDByName("ic_logout_24px"))}})}}),r.React.createElement(R,{label:a.format("settings.auth.delete_data.title",{}),subLabel:a.format("settings.auth.delete_data.description",{}),leading:r.React.createElement(R.Icon,{source:u.getAssetIDByName("trash")}),onPress:function(){return B.showConfirmationAlert({title:a.format("alert.delete_data.title",{}),content:a.format("alert.delete_data.body",{}),confirmText:a.format("alert.delete_data.confirm",{}),confirmColor:"RED",onConfirm:async function(){await Ft(),delete f.auth[et.getCurrentUser().id],delete b.save,E.showToast(a.format("toast.deleted_data",{}),u.getAssetIDByName("trash"))}})}})):r.React.createElement(R,{label:a.format("settings.auth.authorize",{}),leading:r.React.createElement(R.Icon,{source:u.getAssetIDByName("copy")}),trailing:R.Arrow,onPress:jt})),r.React.createElement(ee,{title:a.format("settings.data.title",{}),icon:u.getAssetIDByName("ic_message_edit"),padding:!l||!S},l&&S?r.React.createElement(r.React.Fragment,null,r.React.createElement(R,{label:a.format("settings.data.save_data.title",{}),subLabel:a.format("settings.data.save_data.description",{}),leading:n.includes("save_api")?r.React.createElement(r.ReactNative.ActivityIndicator,{size:"small"}):r.React.createElement(R.Icon,{source:u.getAssetIDByName("ic_file_upload_24px")}),onPress:function(){return B.showConfirmationAlert({title:a.format("alert.save_data.title",{}),content:a.format("alert.save_data.body",{}),confirmText:a.format("alert.save_data.confirm",{}),confirmColor:"BRAND",onConfirm:async function(){o("save_api");try{b.save=await Ge(await Ve()),E.showToast(a.format("toast.saved_data",{}),u.getAssetIDByName("Check"))}catch(p){E.showToast(String(p),u.getAssetIDByName("Small"))}s("save_api")}})}}),r.React.createElement(R,{label:a.format("sheet.import_data.title",{}),subLabel:a.format("settings.data.import_data.description",{}),leading:n.includes("import_api")?r.React.createElement(r.ReactNative.ActivityIndicator,{size:"small"}):r.React.createElement(R.Icon,{source:u.getAssetIDByName("ic_download_24px")}),onPress:function(){de(Ee,{navigation:g}),ze(function(p){return p?o("import_api"):s("import_api")})}}),r.React.createElement(ke,{addPadding:!0}),r.React.createElement(R,{label:a.format("settings.data.export_local_data.title",{}),subLabel:a.format("settings.data.export_local_data.description",{}),leading:n.includes("export_local")?r.React.createElement(r.ReactNative.ActivityIndicator,{size:"small"}):r.React.createElement(R.Icon,{source:u.getAssetIDByName("ic_file_upload_24px")}),onPress:async function(){B.showInputAlert({title:a.format("alert.encryption_key.title",{}),placeholder:a.format("alert.encryption_key.placeholder",{}),confirmText:a.format("alert.encryption_key.confirm",{}),onConfirm:async function(p){if(!p)throw new Error(a.format("alert.encryption_key.required",{}));if(n.length)return;o("local_export");let h;try{h=await Jt(JSON.stringify(b.save),p)}catch{return s("local_export"),E.showToast(a.format("toast.encrypt_fail",{}),u.getAssetIDByName("Small"))}if(v.hasRNFS){const y=`CloudSync_${Math.floor(Math.random()*1e4)}.txt`;v.writeFile(v.DownloadDirectoryPath+`/${y}`,h),E.showToast(a.format("toast.backup_saved",{file:y}),u.getAssetIDByName("ic_file_small_document"))}else{E.showToast(a.format("toast.backup_download_prepare",{}),u.getAssetIDByName("ic_upload"));let y;try{y=await kt(h)}catch(m){return s("local_export"),E.showToast(m?.message??`${m}`,u.getAssetIDByName("Small"))}E.showToast(a.format("toast.backup_saved",{file:y.key}),u.getAssetIDByName("ic_file_small_document")),tn(`https://hst.sh/raw/${y.key}.txt`,3)}s("local_export")}})}}),r.React.createElement(R,{label:a.format("settings.data.import_local_data.title",{}),subLabel:a.format("settings.data.import_local_data.description",{}),leading:n.includes("import_local")?r.React.createElement(r.ReactNative.ActivityIndicator,{size:"small"}):r.React.createElement(R.Icon,{source:u.getAssetIDByName("ic_download_24px")}),onPress:async function(){if(n.length)return;o("import_local");let p;try{const{fileCopyUri:h,type:y}=await _e.pickSingle({type:_e.types.plainText,mode:"open",copyTo:"cachesDirectory"});(y==="text/plain"||!h)&&(p=await v.readFile(h.slice(5),"utf8"))}catch(h){_e.isCancel(h)||E.showToast(a.format("toast.errored",{error:h}),u.getAssetIDByName("Small"))}s("import_local"),p&&B.showInputAlert({title:a.format("alert.decryption_key.title",{}),placeholder:a.format("alert.decryption_key.placeholder",{}),confirmText:a.format("alert.decryption_key.confirm",{}),onConfirm:async function(h){if(!h)throw new Error(a.format("alert.decryption_key.required",{}));if(!n.length){o("import_local");try{const y=JSON.parse(await Xt(p,h));de(Ee,{save:y,navigation:g}),s("import_local"),ze(function(m){return m?o("import_local"):s("import_local")})}catch{return s("import_local"),E.showToast(a.format("toast.decrypt_fail",{}),u.getAssetIDByName("Small"))}}}})}})):l?r.React.createElement(r.ReactNative.ActivityIndicator,{size:"small",style:{flex:1}}):r.React.createElement(Z,{variant:"text-md/semibold",color:"TEXT_NORMAL",align:"center"},a.format("settings.label.auth_needed",{}))),r.React.createElement(qe,{style:{height:12}}))}let tt=0;function on(e){clearTimeout(tt),tt=setTimeout(e,1500)}const{FormSection:sn}=_.Forms,cn=d.findByName("getScreens"),ln=d.findByName("UserSettingsOverviewWrapper",!1),un=r.stylesheet.createThemedStyleSheet({container:{flex:1,backgroundColor:N.semanticColors.BACKGROUND_MOBILE_PRIMARY}});function fn(e,t,n){const i=[],o=O.after("default",ln,function(s,c){o();const g=se.findInReactTree(c.props.children,function(l){return l.type&&l.type.name==="UserSettingsOverview"});i.push(O.after("render",g.type.prototype,function(l,S){let{props:{children:p}}=S;const h=[r.i18n.Messages.BILLING_SETTINGS,r.i18n.Messages.PREMIUM_SETTINGS];p=se.findInReactTree(p,function(m){return m.children[1].type===sn}).children;const y=p.findIndex(function(m){return h.includes(m?.props.label)});e()&&p.splice(y===-1?4:y,0,t({}))}))},!0);if(i.push(o),cn&&n){const s=`BUNNY_PLUGIN_${r.lodash.snakeCase(n.key).toUpperCase()}`,c=n.page.render,g=r.React.memo(function(h){let{navigation:y}=h;const m=y.addListener("focus",function(){m(),y.setOptions(se.without(n.page,"noErrorBoundary","render"))});return r.React.createElement(r.ReactNative.View,{style:un.container},n.page.noErrorBoundary?r.React.createElement(c,null):r.React.createElement(_.ErrorBoundary,null,r.React.createElement(c,null)))}),l={[s]:{type:"route",title:function(){return n.title},icon:n.icon,parent:null,screen:{route:`BunnyPlugin${r.lodash.chain(n.key).camelCase().upperFirst().value()}`,getComponent:function(){return g}}}},S=function(h,y){const m=[...h],C=y?m?.[0]?.sections:m;if(!Array.isArray(C))return C;const F="Bunny",k=C.find(function(j){return j?.title===F||j?.label===F});return k&&!k?.settings?.includes(s)&&k.settings.push(s),m},p=function(){const h=d.findByProps("useOverviewSettings"),y=d.findByProps("getSettingTitleConfig"),m=d.findByProps("SETTING_RELATIONSHIPS","SETTING_RENDERER_CONFIGS"),C="getSettingSearchListItems",F="getSettingListItems",k=d.findByProps(C),j=k?C:F,rt=k??d.findByProps(F);if(!rt||!h)return!1;i.push(O.after("useOverviewSettings",h,function(Ie,Y){return S(Y)})),i.push(O.after("getSettingTitleConfig",y,function(Ie,Y){return{...Y,[s]:n.title}})),i.push(O.after(j,rt,function(Ie,Y){let[yn]=Ie;return[...yn.includes(s)?[{type:"setting_search_result",ancestorRendererData:l[s],setting:s,title:function(){return n.title},breadcrumbs:["Bunny","Nexpid"],icon:l[s].icon}]:[],...Y]}));const Ce=m.SETTING_RELATIONSHIPS,hn=m.SETTING_RENDERER_CONFIGS;return m.SETTING_RELATIONSHIPS={...Ce,[s]:null},m.SETTING_RENDERER_CONFIGS={...hn,...l},i.push(function(){m.SETTING_RELATIONSHIPS=Ce,m.SETTING_RENDERER_CONFIGS=Ce}),!0};(function(){const h=d.findByProps("SearchableSettingsList"),y=d.findByProps("SETTING_RENDERER_CONFIG"),m=d.findByProps("getSettingListItems");if(!m||!h||!y)return!1;i.push(O.before("type",h.SearchableSettingsList,function(F){return S(F,!0)})),i.push(O.after("getSettingListSearchResultItems",m,function(F,k){for(const j of k)j.setting===s&&(j.breadcrumbs=["Bunny","Nexpid"])}));const C=y.SETTING_RENDERER_CONFIG;return y.SETTING_RENDERER_CONFIG={...C,...l},i.push(function(){y.SETTING_RENDERER_CONFIG=C}),!0})()||p()}return function(){return i.forEach(function(s){return s()})}}const{FormRow:Ne}=_.Forms;function dn(){const e=r.NavigationNative.useNavigation();return React.createElement(_.ErrorBoundary,null,React.createElement(Ne,{label:a.format("plugin.name",{}),leading:React.createElement(Ne.Icon,{source:u.getAssetIDByName("ic_contact_sync")}),trailing:Ne.Arrow,onPress:function(){return e.push("VendettaCustomPage",{title:a.format("plugin.name",{}),render:ve})}}))}function gn(){const e=[];return e.push(fn(function(){return f.addToSettings},function(){return React.createElement(dn,null)},{key:ie.plugin.manifest.name,icon:u.getAssetIDByName("ic_contact_sync"),title:a.format("plugin.name",{}),page:{title:a.format("plugin.name",{}),render:ve}})),function(){return e.forEach(function(t){return t()})}}const f=oe.storage;let nt;const b=A.wrapSync(A.createStorage({get:function(){return nt},set:function(e){nt=e}})),be=async function(){return $t().then(function(e){return b.save=e})};function J(e){return e.startsWith(ie.constants.PROXY_PREFIX)}function X(e){return!e.includes("cloud-sync")}const $=async function(){if(!f.autoSync)return;const e=await Ve();JSON.stringify(b.save)!==JSON.stringify(e)&&on(async function(){return b.save=await Ge(e)})},ae=Symbol.for("vendetta.storage.emitter"),Pe=!!D.plugins[ae]&&!!M.themes[ae],a=new dt("cloud_sync"),Te=[];var pn={onLoad:function(){if(f.autoSync??(f.autoSync=!1),f.addToSettings??(f.addToSettings=!1),f.pluginSettings??(f.pluginSettings={}),f.auth??(f.auth={}),x()&&be(),Pe){const e={plugins:D.plugins[ae],themes:M.themes[ae]};e.plugins.on("SET",$),e.themes.on("SET",$),e.plugins.on("DEL",$),e.themes.on("DEL",$),Te.push(function(){e.plugins.off("SET",$),e.themes.off("SET",$),e.plugins.off("DEL",$),e.themes.off("DEL",$)})}Te.push(gn()),oe.storage.databaseMigrate&&delete oe.storage.databaseMigrate},onUnload:function(){return Te.forEach(function(e){return e()})},settings:ve};return I.cache=b,I.canImport=X,I.default=pn,I.emitterAvailable=Pe,I.fillCache=be,I.isPluginProxied=J,I.lang=a,I.vstorage=f,Object.defineProperty(I,"__esModule",{value:!0}),I})({},vendetta,vendetta.plugin,vendetta.plugins,vendetta.storage,vendetta.themes,vendetta.metro.common,vendetta.metro,vendetta.ui.alerts,vendetta.ui.assets,vendetta.ui.components,vendetta.ui.toasts,vendetta.ui,vendetta.patcher,vendetta.utils);
